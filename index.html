<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .parent {
            position: relative;
            top: 0;
            left: 0;
        }
    
        .image1 {
            position: relative;
            top: 0;
            left: 0;
        }
    
        .image2 {
            position: absolute;
            top: 0px;
            left: 0px;
        }
    </style>    
</head>
<body onload="green()">
    <div class="parent">
        <img id="texture" class="image2" src="" width="2042" height="502"/>
        <img id="guitar" class="image1" src="guitar.png" width="2042" height="502"/>
    </div>
    <button onclick="green()">Green Sparkle</button>
    <button onclick="teal()">Aegean Teal</button>
</body>
</html>

<script>
    async function green() {
        var image = await getCombinedBackgroundImage("green_sparkle.png");
        document.getElementById("texture").src = image.src
    }

    async function teal() {
        var image = await getCombinedBackgroundImage("aegean_teal.png");
        document.getElementById("texture").src = image.src
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function getCombinedBackgroundImage(imageName) {
        var backgroundImage = await getBackgroundImage()
        var textureCanvas = document.createElement("canvas")
        textureCanvas.id = "textureCanvas"
        textureCanvas.width = 2042 
        textureCanvas.height = 502
        textureCanvas.hidden = true

        document.body.appendChild(textureCanvas)
        var textureContext = textureCanvas.getContext("2d")
        var textureImage = new Image()

        var imageLoaded = false
        textureImage.onload = function () {
            imageLoaded = true
        }
        textureImage.src = imageName
        while (!imageLoaded) {
            await sleep(500)
        }

        textureContext.fillStyle = textureContext.createPattern(textureImage, "repeat");
        textureContext.fillRect(0, 0, textureCanvas.width, textureCanvas.height);
        textureContext.globalCompositeOperation = "multiply";
        textureContext.drawImage(backgroundImage, 0, 0, backgroundImage.width, backgroundImage.height);
        textureContext.globalCompositeOperation = "destination-in";
        textureContext.drawImage(backgroundImage, 0, 0, backgroundImage.width, backgroundImage.height);

        var image = new Image()
        image.src = textureCanvas.toDataURL()
        textureCanvas.remove()
        return image
    }

    async function getBackgroundImage() {
        var backgroundImage = new Image()

        var imageLoaded = false
        backgroundImage.onload = function () {
            imageLoaded = true
        }

        backgroundImage.src = "white.png"
        while (!imageLoaded) {
            await sleep(500)
        }
        return backgroundImage
    }

</script>