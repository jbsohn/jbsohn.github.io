<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        .parent {
            position: relative;
            top: 0;
            left: 0;
        }

        .image1 {
            position: relative;
            top: 0;
            left: 0;
        }

        .image2 {
            position: absolute;
            top: 0px;
            left: 0px;
        }
    </style>
</head>

<body onload="loadImagesFromDirectory('/HPL', '.jpg')">
    <div class="parent">
        <img id="texture" title="r" class="image2" src="" width="2042" height="502" />
        <img id="guitar" title="r" class="image1" src="guitar.png" width="2042" height="502" />
    </div>
    <br>
    Click a WilsonArt laminate to see a preview.
    <br>
    <div id="clicked">&nbsp;</div>
    <br>
</body>

</html>

<script>
    // adapted from: 
    // https://stackoverflow.com/questions/55268506/how-do-i-fetch-all-images-in-a-folder-with-ajax-using-pure-js/
    function loadImagesFromDirectory(dir, fileextension) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", dir, true);
        xhr.responseType = 'document';
        xhr.onload = () => {
            if (xhr.status === 200) {
                var elements = xhr.response.getElementsByTagName("a");
                for (x of elements) {
                    if (x.href.match(/\.(jpe?g|png|gif)$/)) {
                        let img = document.createElement("img");
                        img.src = x.href;
                        img.width = 40
                        img.height = 40
                        img.role = 'button'
                        var element = document.body.appendChild(img);
                        element.setAttribute("onclick", "onClickTexture('" + element.src + "')")
                    }
                };
            }
            else {
                alert('Request failed. Returned status of ' + xhr.status);
            }
        }
        xhr.send()
    }

    function onClickTexture(imageName) {
        document.getElementById("clicked").innerText = imageName
        getBackgroundImage(imageName, function (image) {
            document.getElementById("texture").src = image.src
        })
    }

    function getBackgroundImage(imageName, onComplete) {
        loadImage("white.png", function (backgroundImage) {
            var textureCanvas = document.createElement("canvas")
            textureCanvas.id = "textureCanvas"
            textureCanvas.width = 2042
            textureCanvas.height = 502
            textureCanvas.hidden = true
            document.body.appendChild(textureCanvas)

            loadImage(imageName, function (textureImage) {
                var textureContext = textureCanvas.getContext("2d")
                textureContext.fillStyle = textureContext.createPattern(textureImage, "repeat");
                textureContext.fillRect(0, 0, textureCanvas.width, textureCanvas.height);
                textureContext.globalCompositeOperation = "multiply";
                textureContext.drawImage(backgroundImage, 0, 0, backgroundImage.width, backgroundImage.height);
                textureContext.globalCompositeOperation = "destination-in";
                textureContext.drawImage(backgroundImage, 0, 0, backgroundImage.width, backgroundImage.height);

                var image = new Image()
                image.src = textureCanvas.toDataURL()
                textureCanvas.remove()
                onComplete(image)
            })
        })
    }

    function loadImage(imageName, onComplete) {
        var image = new Image()
        image.onload = function () {
            onComplete(image)
        }
        image.src = imageName
    }
</script>